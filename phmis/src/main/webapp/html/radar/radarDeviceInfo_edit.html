<!DOCTYPE html>
<html>
  <head>
    <title>radarDeviceInfo</title>
	
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8">
    
        <link rel="stylesheet" href="/static/ace/css/font-awesome1.css" />  
	    <link href="/static/ace/css/style.min.css?v=4.1.0" rel="stylesheet">
		<link href="/static/ace/css/bootstrap.min1.css" rel="stylesheet"> 
		<!-- text fonts -->
		<link rel="stylesheet" href="/static/ace/css/ace-fonts.css" />
		<!-- ace styles -->
		<link rel="stylesheet" href="/static/ace/css/ace.css" class="ace-main-stylesheet" id="main-ace-style" /> 
		<link href="/static/ace/js/sweetalert/sweetalert.css" rel="stylesheet">        
		<script type="text/javascript" src="/static/ace/js/jquery.js"></script>  
		<script src="/static/ace/js/bootstrap.js"></script>
		<script src="/static/js/util.js"></script>
		<script src="/static/ace/js/sweetalert/sweetalert.min.js"></script>
		
		   <script src="/static/ace/js/bootstrap-datetimepicker.js"></script>
		<script src="/static/ace/js/bootstrap-datetimepicker.zh-CN.js"></script>
		<link rel="stylesheet" href="/static/ace/css/bootstrap-datetimepicker.min.css" class="ace-main-stylesheet" id="main-ace-style" /> 
			<link rel="stylesheet" href="/static/ace/bootstrapvalidator-master/dist/css/bootstrapValidator.css" />

	<script type="text/javascript" src="/static/ace/bootstrapvalidator-master/dist/js/bootstrapValidator.js"></script>
		

  </head>
  
    <body class="no-skin">
<div class="main-container" id="main-container">
		<!-- /section:basics/sidebar -->
		<div class="main-content">
			<div class="main-content-inner">
				<div class="page-content">
					<div class="row">
						<div class="col-xs-12">
							<form id="defaultForm" method="post" class="form-horizontal">

							
							
							<table id="table_report" class="table table-striped table-bordered table-hover"> 
							<tr>
										<td style="width: 89px; text-align: right; padding-top: 13px;">
											雷达编号：
										</td>
										<td class="controlcontent" colspan=3>
										<input type="text"
											id="id" name="id"
											placeholder="雷达编号" title="id"
											style="width: 98%;" />
										</td>
									</tr>			
							    <tr>				
							    	<td style="width:120px;text-align: right;padding-top: 13px;">
										站区/用户编号：
									</td>
									<td class="controlcontent" >
										<select class="chosen-select form-control"  name="stationId" id=stationId data-placeholder="请选择省份" style="vertical-align:top;"  title="省份" style="width:98%;" >
								  			<option  value=''>请选择</option> 
										</select>
								    </td>						
									<td style="width:120px;text-align: right;padding-top: 13px;">
										雷达名称：
									</td>
									<td class="controlcontent" >
										<input type="text" id="radarName" name="radarName"   placeholder="输入radarName" title="radarName" style="width:98%;" />
								 	</td>									
								</tr>			 
							    <tr>								
									<td style="width:120px;text-align: right;padding-top: 13px;">
										型号编号：
									</td>
									<td class="controlcontent" >
										<select class="chosen-select form-control"   name="typeId" id=typeId data-placeholder="请选择省份" style="vertical-align:top;"  title="省份" style="width:98%;" >
								  			<option  value=''>请选择</option> 
										</select>
								 	</td>									
													
									<td style="width:120px;text-align: right;padding-top: 13px;">
										生产厂家：
									</td>
									<td class="controlcontent" >
										<input type="text" id="manufacturer" name="manufacturer"  placeholder="输入manufacturer" title="manufacturer" style="width:98%;" />
								 	</td>									
								</tr>			 
							    	 
							    <tr>								
									<td style="width:120px;text-align: right;padding-top: 13px;">
										生产日期：
									</td>
									<td class="controlcontent" >
									<div style="width:98%;" id='manufacturerDateD' class="input-group date form_date col-md-5" data-date="" data-date-format="" data-link-field="dtp_input1" data-link-format="yyyy-mm-dd">
								            <input style="width:98%;"   id="manufacturerDate" placeholder="生产日期"  name="manufacturerDate" class="form-control" size="16" type="text" value="" readonly>
								            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
								     </div> 
 								 	</td>									
								 						
									<td style="width:120px;text-align: right;padding-top: 13px;">
										安装位置：
									</td>
									<td class="controlcontent" >
										<input type="text" id="address" name="address"   placeholder="输入address" title="address" style="width:98%;" />
								 	</td>									
								</tr>			 
							    <tr>								
									<td style="width:120px;text-align: right;padding-top: 13px;">
										工作令：
									</td>
									<td class="controlcontent" >
										<input type="text" id="workOrder" name="workOrder"   placeholder="输入workOrder" title="workOrder" style="width:98%;" />
								 	</td>									
								 							
									<td style="width:120px;text-align: right;padding-top: 13px;">
										架设时间：
									</td>
									<td class="controlcontent" >
									<div style="width:98%;" id='erectionTimeD' class="input-group date form_date col-md-5" data-date="" data-date-format="" data-link-field="dtp_input1" data-link-format="yyyy-mm-dd">
								            <input style="width:98%;"   id="erectionTime" placeholder="生产日期"  name="erectionTime" class="form-control" size="16" type="text" value="" readonly>
								            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
								     </div> 
 								 	</td>									
								</tr>			 
							    <tr  id="trdd">								
									<td style="width:120px;text-align: right;padding-top: 13px;">
										在役状态：
									</td>
									<td class="controlcontent" >
									<select class="chosen-select form-control"    name="inServiceState" id=inServiceState data-placeholder="请选择省份" style="vertical-align:top;"  title="省份" style="width:98%;" >
								  			<option  value=''>请选择</option> 
								  			<option  value='1'>是</option> 
								  			<option  value='0'>否</option> 
										</select>
								  	</td>									
								 							
									<td style="width:120px;text-align: right;padding-top: 13px;">
										任务属性：
									</td>
									<td class="controlcontent" >
										<select class="chosen-select form-control"    name="taskAttributeId" id=taskAttributeId data-placeholder="请选择省份" style="vertical-align:top;"  title="省份" style="width:98%;" >
								  			<option  value=''>请选择</option> 
										</select>
							 		 	</td>									
								</tr>		 	 
							    <tr>								
									<td style="width:120px;text-align: right;padding-top: 13px;">
										功能说明：
									</td>
									<td class="controlcontent" colspan=3>
									 <textarea rows="3" cols="46" maxlength="255" name="description" id="description" placeholder="这里输入描述" title="描述"  style="width:100%;"></textarea>
									
 								 	</td>									
								</tr>		   
								<tr>
									<td class="center" colspan="4">
										 <button  type='button' id='validateBtn'  class='btn btn-sm btn-info'><span class="glyphicon glyphicon-save"></span> 保存</button>
											&nbsp;&nbsp;&nbsp;&nbsp;
		  								  <button  type='button' onclick='closeWin();' class='btn btn-xs btn-danger'><span class="glyphicon glyphicon-remove"></span> 取消</button>
	 
									</td>
								</tr>
							</table>
							</div>
						 	</form>
						</div>
						<!-- /.col -->
					</div>
					<!-- /.row -->
				</div>
				<!-- /.page-content -->
			</div>
		</div>
		<!-- /.main-content -->
	</div> 	                  
</body>	
 
<script type="text/javascript">
		$(top.hangge());
	  var radarStateMap=new Map();
	  var ids=getParamer("id");
		if(ids!='-9999'){
			$("#id").attr("readonly","readonly");
		}
		//保存	
		//保存	
	 function save(){
	 		  var radarBasicStateInfoArr=new Array();
	 	     for ( var i = 0; i < radarStateMap.arr.length; i++) {
		        var radarBasicStateInfo=new Object();
		        radarBasicStateInfo=radarStateMap.get(radarStateMap.arr[i].key); 
		        radarBasicStateInfo.radarStateInfoValueId=$("#radarStateInfoValues_"+radarStateMap.arr[i].value.radarStateInfoId).val();
		        radarBasicStateInfoArr[i]=radarBasicStateInfo;
		        ///alert(i+"----------"+sealApplyFormExtensionMap.arr[i].key+"---"+sealApplyFormExtension.sealUseExtensionContent);
				 
			} 
		     $.ajax({
				type: "POST",
				url: '/radarDeviceInfo/save', 
				contentType: 'application/json', // 这句不加出现415错误:Unsupported Media Type
				data:JSON.stringify({   
					  'radarName':$("#radarName").val(),
					  'typeId':$("#typeId").val(),
					  'description':$("#description").val(),
					  'manufacturer':$("#manufacturer").val(),
					  'stationId':$("#stationId").val(),
					  'manufacturerDate':$("#manufacturerDate").val(),
					  'address':$("#address").val(),
					  'workOrder':$("#workOrder").val(),
					  'erectionTime':$("#erectionTime").val(),
					  'inServiceState':$("#inServiceState").val(),
					  'taskAttributeId':$("#taskAttributeId").val(),
					  'radarBasicStateInfos':radarBasicStateInfoArr,
					  'id':$("#id").val()
				  }),
				dataType:'json',
				cache: false,
				success: function(data){ 
					$(top.hangge());
					if(data && data!=""){ 
						
						if("success" == data.result){
						  parent.queryList(); 
                          var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
      					  parent.layer.close(index);
      					  parent.swal("保存成功！", "您已经成功新增了这条信息。", "success");
						}
						else if("err" == data.result){ 
						   parent.swal("保存失败！", data.msg, "error");	
						}						     
				    } 
				 }
			   });
		    }
			　 
		
	 
	  
	$(function(){
  		init();
	});
	function init(){ 
		  　 $.ajax({
				type: "GET",
				url: '/radarDeviceInfo/getAll', 
				dataType:'json',
				cache: false,
				success: function(data){
				  //  alert(data);
					if(data && data!=""){  
				 	  $("#typeId").html("");
				        $("#typeId").append('<option value="">请选择</option>');
						$.each(data.radarTypeInfos,function(i,item){  	 
						     //  alert(item.id);  
						      	$("#typeId").append("<option  value='"+item.id+"'>"+item.radarTypeName+"</option>");	 
					      　});      
					      
					   $("#stationId").html("");
				        $("#stationId").append('<option value="">请选择</option>');
						$.each(data.radarUserInfos,function(i,item){  	 
						     //  alert(item.id);  
						      	$("#stationId").append("<option  value='"+item.id+"'>"+item.stationName+"</option>");	 
					      　});      		
					     $("#taskAttributeId").html("");
				        $("#taskAttributeId").append('<option value="">请选择</option>');
						$.each(data.taskAttributes,function(i,item){  	 
						     //  alert(item.id);  
						      	$("#taskAttributeId").append("<option  value='"+item.id+"'>"+item.tname+"</option>");	 
					      　});       
					    var html="";
					   $.each(data.radarStateInfos,function(i,item){  	 
						      var radarBasicStateInfo=new Object();	
					    	  radarBasicStateInfo.radarStateInfoId=item.id;					    	  
						      radarStateMap.put(item.id,radarBasicStateInfo);
					 		  html=html+"<tr>";								
					          html=html+"<td style=\"width:120px;text-align: right;padding-top: 13px;\">";
							  html=html+item.sname;
							  html=html+"</td>";
							  html=html+"<td class=\"controlcontent\" colspan=3>";
							  html=html+"<select class=\"chosen-select form-control\"  id='radarStateInfoValues_"+item.id+"'  style=\"width:98%;\" >";
							   html=html+"<option  value=''>请选择</option> ";
							  $.each(item.radarStateInfoValues,function(i,item1){  
							  	 html=html+"<option  value='"+item1.id+"'>"+item1.svalue+"</option> ";
							  });
							  html=html+"</select>";
 							  html=html+"</td>";									
						      html=html+"</tr>";	  
					      　});      
					  $("#trdd").after(html);  
					     		
					  
					   initVo();		     
				    } 
				 }
			   });
	} 
		
   function initVo(){
   	 $.ajax({
				type: "GET",
				url: '/radarDeviceInfo/getEntityById/'+getParamer("id"), 
				dataType:'json',
				cache: false,
				success: function(data){
				  //  alert(data);
					if(data && data!=""){  
					  $("#radarName").val(data.radarName);
					  $("#typeId").val(data.typeId);
					  $("#description").val(data.description);
					  $("#manufacturer").val(data.manufacturer);
					  $("#stationId").val(data.stationId);
					  $("#manufacturerDate").val(data.manufacturerDateStr);
					  $("#address").val(data.address);
					  $("#workOrder").val(data.workOrder);
					  $("#erectionTime").val(data.erectionTimeStr);
					  $("#inServiceState").val(data.inServiceState);
					  $("#taskAttributeId").val(data.taskAttributeId);

					  $("#id").val(data.id);	
					   if(id!='-1'){	
					   var html="";
					   debugger
					   $.each(data.radarBasicStateInfoes,function(i,item){  	 
					   		 
						     $("#radarStateInfoValues_"+item.radarStateInfoId).val(item.radarStateInfoValueId);
					      　});      
					      }
					  $("#trdd").after(html); 		     
				    } 
				 }
			   });
   }
		
		
		 $('#manufacturerDateD').datetimepicker({  
		    format: 'yyyy-mm-dd',
	        minView:'month',
	        language: 'zh-CN',
	        autoclose:true,
	        weekStart:1 
		 });
		 
		  $('#erectionTimeD').datetimepicker({  
		    format: 'yyyy-mm-dd',
	        minView:'month',
	        language: 'zh-CN',
	        autoclose:true,
	        weekStart:1 
		 });
		
		  
			/***

			开始验证

			***/

			 

			$(document).ready(function() { 	    

		  	  $('#defaultForm').bootstrapValidator({

		        live: 'disabled',

		        message: 'This value is not valid',

		        feedbackIcons: {

		            valid: 'glyphicon glyphicon-ok',

		            invalid: 'glyphicon glyphicon-remove',

		            validating: 'glyphicon glyphicon-refresh'

		        },

		        fields: {

		       	 /*常用验证可以参考

		            stringLength: {

		                min: 2,

		                max: 50,

		                message: '%field_desc_name%必须为2-50个字符之间'

		            },

		            regexp: {

		                regexp: /^[a-zA-Z0-9_\.]+$/,

		                message: '%field_desc_name%必须为数字或字母'

		            },

		            emailAddress: {

		                        message: '%field_desc_name%不是邮件地址'

		            },

		            date: {

		                format: 'YYYY/MM/DD',

		                message: '%field_desc_name%日期格式不对'

		            },

		            remote: {

		                type: 'POST',

		                url: 'remote.php',

		                message: '%field_desc_name%已被占用'

		            }*/

				  /***
				    验证字段radarName是否为空或别的验证逻辑都写在这里
				  ***/	 
				  id: {
		              group: '.controlcontent',
		              validators: {
		                  notEmpty: {
		                      message: '编号为必填项'
		                  },
		                  stringLength: {
				                min: 1,
				                max: 32,
				                message: '编号必须为1-32个字符,1个汉字为2个字符'
				            },
				            remote: {
				                type: 'POST',
				                delay :  500,
				                url: '/radarDeviceInfo/checkIdValidMethod',
				                message: '编号已被占用'
				            }  
		              }
		          },
		          stationId: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '站区/用户编号为必填项'
		                    } 
		                }
		            },
		            stationId: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '站区/用户编号为必填项'
		                    } 
		                }
		            },
		          typeId: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '型号编号为必填项'
		                    } 
		                }
		            },
		            taskAttributeId: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '任务属性为必填项'
		                    } 
		                }
		            },
		            
				   radarName: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '雷达名称为必填项'
		                    },
		                    stringLength: {
				                min: 1,
				                max: 20,
				                message: '雷达名称必须为1-20个字符,1个汉字为2个字符'
				            }
		                }
		            },
				  /***
				    验证字段description是否为空或别的验证逻辑都写在这里
				  ***/	 
				   description: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '功能说明为必填项'
		                    },
		                    stringLength: {
				                min: 1,
				                max: 50,
				                message: '功能说明必须为1-50个字符,1个汉字为2个字符'
				            }
		                }
		            },
				  /***
				    验证字段manufacturer是否为空或别的验证逻辑都写在这里
				  ***/	 
				   manufacturer: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '生产厂家为必填项'
		                    },
		                    stringLength: {
				                min: 1,
				                max: 50,
				                message: '生产厂家必须为1-50个字符,1个汉字为2个字符'
				            }
		                }
		            },
				  /***
				    验证字段manufacturerDate是否为空或别的验证逻辑都写在这里
				  ***/	 
				   manufacturerDate: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '生产日期为必填项'
		                    } 
		                }
		            },
				  /***
				    验证字段address是否为空或别的验证逻辑都写在这里
				  ***/	 
				   address: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '安装位置为必填项'
		                    },
		                    stringLength: {
				                min: 1,
				                max: 50,
				                message: '安装位置必须为1-50个字符,1个汉字为2个字符'
				            }
		                }
		            },
				  /***
				    验证字段workOrder是否为空或别的验证逻辑都写在这里
				  ***/	 
				   workOrder: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '工作令为必填项'
		                    },
		                    stringLength: {
				                min: 1,
				                max: 50,
				                message: '工作令必须为1-50个字符,1个汉字为2个字符'
				            }
		                }
		            },
				  /***
				    验证字段erectionTime是否为空或别的验证逻辑都写在这里
				  ***/	 
				   erectionTime: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '架设时间为必填项'
		                    } 
		                }
		            },
				  /***
				    验证字段inServiceState是否为空或别的验证逻辑都写在这里
				  ***/	 
				   inServiceState: {
		                group: '.controlcontent',
		                validators: {
		                    notEmpty: {
		                        message: '在役状态为必填项'
		                    },
		                    stringLength: {
				                min: 1,
				                max: 50,
				                message: '在役状态必须为1-50个字符,1个汉字为2个字符'
				            }
		                }
		            },


		        } 

		    });



		    // Validate the form manually
			
		    $('#validateBtn').click(function() {
		    	var ids=getParamer("id"); 
		     	if(ids!='-9999'){
		     		$("#defaultForm").bootstrapValidator('removeField','id');
		     	}
		        $('#defaultForm').bootstrapValidator('validate');

		    }); 

		}).on('success.form.bv', function (e){

			// 阻止默认事件提交

			$('#validateBtn').attr("disabled");

			top.jzts();

			e.preventDefault();

			save();

		}).on('hide',function(e) {
            $('#defaultForm').data('bootstrapValidator')
            .updateStatus('erectionTime', 'NOT_VALIDATED',null)
            .validateField('erectionTime');
            
            $('#defaultForm').data('bootstrapValidator')
            .updateStatus('manufacturerDate', 'NOT_VALIDATED',null)
            .validateField('manufacturerDate');
    }); 

			

</SCRIPT>
<!-- ace scripts --> 
	<!-- inline scripts related to this page -->
	<!-- 下拉框 -->
	<script src="/static/ace/js/chosen.jquery.js"></script>
	<!-- 日期框 -->
	<script src="/static/ace/js/date-time/bootstrap-datepicker.js"></script>
	<!--提示框-->
	<script type="text/javascript" src="/static/js/jquery.tips.js"></script>
  <script type="text/javascript">
		$(top.hangge());
</script>	 
</html>
