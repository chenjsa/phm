<!DOCTYPE html>
<html>
  <head>
    <title>taskResult编辑</title>
	
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8"> 
		<link href="/static/ace/css/bootstrap.min1.css" rel="stylesheet"> 
		<link rel="stylesheet" href="/assets/css/font-awesome.min.css" /> 
		<!--[if IE 7]>
		  <link rel="stylesheet" href="/assets/css/font-awesome-ie7.min.css" />
		<![endif]-->
		<!-- page specific plugin styles -->
		<link rel="stylesheet" href="/assets/css/jquery-ui-1.10.3.full.min.css" />
		<link rel="stylesheet" href="/assets/css/datepicker.css" />
		<link rel="stylesheet" href="/assets/css/ui.jqgrid.css" /> 
		<!-- ace styles -->
		<link rel="stylesheet" href="/assets/css/ace.min.css" />
		<link rel="stylesheet" href="/assets/css/ace-rtl.min.css" />
		<link rel="stylesheet" href="/assets/css/ace-skins.min.css" />
		<!--[if lte IE 8]>
		  <link rel="stylesheet" href="/assets/css/ace-ie.min.css" />
		<![endif]-->
		<!-- inline styles related to this page -->
		<!-- ace settings handler -->
		<script src="/assets/js/ace-extra.min.js"></script>
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
		<script src="/assets/js/html5shiv.js"></script>
		<script src="/assets/js/respond.min.js"></script>
		<![endif]-->		
		<!-- basic scripts --> 
		<script type="text/javascript">
			window.jQuery || document.write("<script src='/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script> 
		<script type="text/javascript">
			 window.jQuery || document.write("<script src='/assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
		</script> 
		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="/assets/js/bootstrap.min.js"></script>
		<script src="/assets/js/typeahead-bs2.min.js"></script>
		<!-- page specific plugin scripts -->
		<script src="/assets/js/date-time/bootstrap-datepicker.min.js"></script>
		<script src="/assets/js/jqGrid/jquery.jqGrid.min.js"></script>
		<script src="/assets/js/jqGrid/i18n/grid.locale-cn.js"></script> 
		<!-- ace scripts --> 
		<script src="/assets/js/ace-elements.min.js"></script>
		<script src="/assets/js/ace.min.js"></script>
	    <script type="text/javascript" src="/plugins/layer/3.0/layer.js"></script>
		<link href="/static/ace/js/sweetalert/sweetalert.css" rel="stylesheet">     
		<script src="/static/ace/js/sweetalert/sweetalert.min.js"></script>
		<!-- inline scripts related to this page -->
	    <script src="/static/ace/js/bootstrap-datetimepicker.js"></script>
		<script src="/static/ace/js/bootstrap-datetimepicker.zh-CN.js"></script> 
 		<link rel="stylesheet" href="/assets/css/common.css" />
 		<script src="/static/js/util.js"></script> 
  </head>
 <body> 
 <div id="gsearch" style="display:none;" title="查询窗口">  
   <table id="table_report" class="table table-striped table-bordered table-hover" style="width:100%;align:center"> 		
         <tr>								
		<td style="width:90px;text-align: right;padding-top: 13px;">
			<span class="label label-success arrowed">记录时间：</span>
		</td>
		<td class="controlcontent"  >
			<div style="width:98%;" id='recordTimeBB' class="input-group date form_date col-md-5" data-date="" data-date-format="" data-link-field="dtp_input1" data-link-format="yyyy-mm-dd">
								            <input style="width:98%;"   id="recordTimeB" placeholder="开始时间"  name="recordTimeB" class="form-control" size="16" type="text" value="" readonly>
								            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
								     </div> 
								     </td>
						<td class="controlcontent" colspan=2 >			     
								     <div style="width:98%;" id='recordTimeEE' class="input-group date form_date col-md-5" data-date="" data-date-format="" data-link-field="dtp_input1" data-link-format="yyyy-mm-dd">
								            <input style="width:98%;"   id="recordTimeE" placeholder="结束时间"  name="recordTimeE" class="form-control" size="16" type="text" value="" readonly>
								            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
								     </div> 
 	  	</td>			
	   </tr> 	
         <tr>								
		<td style="width:90px;text-align: right;padding-top: 13px;">
			<span class="label label-success arrowed">雷达编号：</span>
		</td>
		<td style="width:210px;text-align: right;padding-top: 13px;" class="controlcontent" >
		
		 <div class="input-group col-xs-12">   
          	
          	 
			<input  type="text" id="radarId" placeholder="雷达编号"   onblur="changeRadar(this.value);"  class='form-control'  style="width:98%;" name="radarId" autocomplete="off" />
        <span class="input-group-btn" style="align:left">  
            <button class="btn btn-success"  onclick="goTree();"  >	
         			    <span class="glyphicon glyphicon-user"></span>选择
		   </button>  
        </span>  
	    </div>   
		 
	  	</td>			
	  
	   <td style="width:90px;text-align: right;padding-top: 13px;">
			<span class="label label-success arrowed">子系统：</span></td>
		<td style="width:210px;text-align: right;padding-top: 13px;" class="controlcontent">
			<select class="form-control" onchange="changeSubsystem(this);" name="phmsubsId" id='phmsubsId'   style="width:98%;" >
	  		</select>
		</td>
	   </tr>
	   <tr>
		<td style="width:90px;text-align: right;padding-top: 13px;">
	<span class="label label-success arrowed">		关重件：</span></td>
		<td class="controlcontent">
			<select class="form-control"  name="moduleId" id='moduleId'   style="width:98%;" >
	  		</select>
		</td>
		 
											<td style="width:90px;text-align: right;padding-top: 13px;">
											<span class="label label-success arrowed">	 功能类型： </span>
											</td>
											<td class="controlcontent">
											
										    	<select class="form-control"  name="phmfunctionTypeId" id='phmfunctionTypeId'   style="width:98%;" >
										  			  
												</select>
											</td></tr>
        					  
        					  
       				  

	</table> 
</div>


<div class="widget-container-span">
	<div class="widget-box" style="width:100%;">
		<div class="widget-header">
			<h5> <span class="glyphicon glyphicon-book"></span>信息维护</h4>
			<div class="widget-toolbar">
				<a href="#" data-action="reload">
					<i class="icon-refresh"></i>
				</a>

				<a href="#" data-action="collapse">
					<i class="icon-chevron-up"></i>
				</a>
			</div>			
			<div class="widget-toolbar"> 
				  <button type="button"  id="gsearch"  onclick="gsearch();" class="btn btn-xs btn-success">
					<span class="glyphicon glyphicon-search"></span> 查询
				  </button>
			</div>
			<div class="widget-toolbar">
				<button type="button" id="goAdd"  onclick='add();'  style="display:none" class="btn btn-xs btn-danger">  
					<span class="glyphicon glyphicon-export"></span>新增
				</button>
			</div>			 
		</div>
		<div class="widget-body">			 
			<div class="widget-main">
				 <table id="list2"></table> 
				 <div id="pager2"></div>  
			</div>
		</div>
	</div>
</div> 
 </body>
  <script type="text/javascript">
  $('#recordTimeBB').datetimepicker({  
	   format:'yyyy-mm-dd hh:ii:ss',
       minView:'month',
       language: 'zh-CN',
       autoclose:true,
        minView:0,//最精准的时间选择为日期  0-分 1-时 2-日 3-月
       weekStart:1 
	 });
  
  $('#recordTimeEE').datetimepicker({  
	   format:'yyyy-mm-dd hh:ii:ss',
      minView:'month',
      language: 'zh-CN',
      autoclose:true,
       minView:0,//最精准的时间选择为日期  0-分 1-时 2-日 3-月
      weekStart:1 
	 });
	$(top.hangge());
	$(function(){
       pageInit();
    }); 
    
    function pageInit(){ 
       var pageHeaderHeight =$(window).height()-178; 
       var postData={  
		  'taskId':$('#taskId').val(),
		  'recordTime':$('#recordTime').val(),
		  'resultData':$('#resultData').val(),
		  'remark':$('#remark').val(),
		  'phmtaskInfo.radarId':$('#radarId').val(),
		  'phmtaskInfo.phmfunctionTypeId':$('#phmfunctionTypeId').val(),
		  'phmtaskInfo.moduleId':$('#moduleId').val(),
		  'phmtaskInfo.phmsubsId':$('#phmsubsId').val(),
		  'recordTimeB':$('#recordTimeB').val(),
		  'recordTimeE':$('#recordTimeE').val(),
		  'fromMenu':"2" 
	   };
      jQuery("#list2").jqGrid(
      {
        url:'/taskResult/list',
        width : $(window).width()-20, 
		multiselect : true, 
		multiboxonly:true,  
		 altRows: true,
		rownumbers :true,
		height:pageHeaderHeight, 
        datatype : "json",
        caption:"<span class=\"glyphicon glyphicon-list\"></span>列表信息 ", 
        styleUI: 'Bootstrap',//设置jqgrid的全局样式为bootstrap样式  
        shrinkToFit: true,
        colNames :[
	    			'<span class="glyphicon glyphicon-list-alt"></span>任务编号',
	    			'<span class="glyphicon glyphicon-list-alt"></span>雷达编号',
	    			'<span class="glyphicon glyphicon-list-alt"></span>子系统编号',
	    			'<span class="glyphicon glyphicon-list-alt"></span>关重件编号',
	    			'<span class="glyphicon glyphicon-list-alt"></span>功能编号',
	    			'<span class="glyphicon glyphicon-list-alt"></span>记录时间',
	    			'<span class="glyphicon glyphicon-list-alt"></span>结果数据',
	    			'<span class="glyphicon glyphicon-list-alt"></span>备注',

	    			'<span class="glyphicon glyphicon-check"></span>操作'
	    		   ],
        colModel :  [  
					{name : 'taskId',index : 'taskId',sortable:true},
					{name : 'phmtaskInfo.radarDeviceInfo.radarName',index : 'phmtaskInfo.radarId',sortable:true},
					{name : 'phmtaskInfo.radarSubsystemInfo.subsystemInfo.subsystemName',index : 'phmtaskInfo.radarSubsystemInfo.id',sortable:true},
					{name : 'phmtaskInfo.keyModulesInfo.keyModulesName',index : 'phmtaskInfo.keyModulesInfo.keyModulesName',sortable:true},
					{name : 'phmtaskInfo.phmfunctionTypeInfo.phmfunctionTypeName',index : 'phmtaskInfo.phmfunctionTypeId',sortable:true},

					{name : 'recordTime',index : 'recordTime',sortable:true,formatter:function(cellvalue, options, row){return new Date(cellvalue).toLocaleString()}, align:'center'},

					{name : 'resultData',index : 'resultData',sortable:true},
					{name : 'remark',index : 'remark',sortable:true},

	                {
						name : "id",
						index : "id",
						align : "center",
						sortable : false,
						formatter :function(value, options, rData) {     
			         		  var html="<a id='goView-"+value+"'    class='btn btn-xs btn-info' title='统计分析' onclick=view('"+value+"');><i class='glyphicon glyphicon-indent-right' title='统计分析'></i></a>";
			          	 	  html=html+"&nbsp;&nbsp;<a id='goEdit-"+value+"'  style='display:none' class='btn btn-xs btn-success' title='修改' onclick=edit('"+value+"');><i class='glyphicon glyphicon-log-out' title='修改'></i></a>";
			          	 	  html=html+"&nbsp;&nbsp;<a id='delete-"+value+"'   class='btn btn-xs btn-danger' title='删除' onclick=del('"+value+"');><i class='glyphicon glyphicon-remove' title='删除'></i></a>";
			          	 	  return html; 
			           }     	   
					}
	               ],
        rowNum : 10,
        rowList : [ 10, 20, 30 ],
        pager : '#pager2',
        sortname : 'id',
        postData:postData, //发送数据
        mtype : "post",
        viewrecords : true, 
        //toolbar: [true, "top"],
        
        loadComplete:function(){
        	var table = this;
			setTimeout(function(){
				styleCheckbox(table);							
				updateActionIcons(table);
				updatePagerIcons(table);
				enableTooltips(table);
			}, 0);
        	init();
        }             
      });
      $("#t_list2").css({"background-color":"","height":"40px"});
      jQuery("#list2").jqGrid('navGrid', '#pager2', {edit :false,add : false,del : false,search:false});
	}  

	function queryList() {
	  var postData={  
		  'taskId':$('#taskId').val(),
		  'recordTime':$('#recordTime').val(),
		  'resultData':$('#resultData').val(),
		  'remark':$('#remark').val(),
		  'phmtaskInfo.radarId':$('#radarId').val(),
		  'phmtaskInfo.phmfunctionTypeId':$('#phmfunctionTypeId').val(),
		  'phmtaskInfo.moduleId':$('#moduleId').val(),
		  'phmtaskInfo.phmsubsId':$('#phmsubsId').val(),
		  'recordTimeB':$('#recordTimeB').val(),
		  'recordTimeE':$('#recordTimeE').val(),
		  'fromMenu':"2" 
	   };
	  $("#list2").jqGrid('setGridParam',{  
	          postData:postData, //发送数据 
	          datatype:'json',  
	          page:1 
	      }).trigger("reloadGrid"); //重新载入  
	}
  </script>
  
  <script type="text/javascript"> 
		//检索
		function gsearch(){ 	
	     layer.open({
			 	 type: 1, 
			 	 title:'<span class=\"glyphicon glyphicon-list\"></span>筛选条件',
			 	 closeBtn: 1,
			 	 offset: 'auto', 
				 content: $("#gsearch"),
				 btn: [' <span class="glyphicon glyphicon-search"></span>查询', '<span class="glyphicon glyphicon-search"></span>统计分析','<span class="glyphicon glyphicon-remove"></span>取消'],
			     area: ['800px'],
				 maxmin: true,
      			 shadeClose: true, //点击遮罩关闭层
				 yes: function(index, layero){ 
				 	queryList();
					layer.close(index);
				}, 
				no: function(index){ 
					layer.close(index);
				} 
	       });  
		} 
		//新增
		function add(){
		 layer.open({
		 	type: 2, 
		 	closeBtn: 1,
		 	title:'<span class="glyphicon glyphicon-import"></span>信息编辑',
		 	offset: 'auto',
		 	area: ['800px', '480px'],
			content: '/html/taskResult/taskResult_edit.html', 
			shadeClose: false,
		    maxmin: true,
			yes: function(index, layero){  
			}, 
			no: function(index){ 
				layer.close(index);
			}
		  }); 
		} 
		//修改
		function edit(Id){
			layer.open({
			 	type: 2, 
			 	closeBtn: 1,
			 	title:'<span class="glyphicon glyphicon-import"></span>信息编辑',
			 	offset: 'auto',
			 	area: ['800px', '480px'],
				content: '/html/taskResult/taskResult_edit.html?id='+Id, 
				shadeClose: false,
			    maxmin: true,
				yes: function(index, layero){  
				}, 
				no: function(index){ 
					layer.close(index);
				}
			  });  
		}
		///删除
		function del(Id){
		  swal({
                title: "您确定要删除这条信息吗",
                text: "删除后将无法恢复，请谨慎操作！",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "是的，我要删除！",
                cancelButtonText: "让我再考虑一下…",
                closeOnConfirm: false,
                closeOnCancel: false
            }, function (isConfirm) {
                if (isConfirm) {
                var url = "/taskResult/delete/"+Id;
					$.get(url,function(data){
						if("success" == data.msg){	
						    swal("删除成功！", "您已经永久删除了这条信息。", "success")					    
							queryList();
						}else if("error" == data.msg){
							top.hangge();
							swal("删除失败！", "已有关联数据禁止删除:"+data.data, "error")		
						}
					});
                   
                } else {
                    swal("已取消", "您取消了删除操作！", "error")
                }
            })
	  
			     
		}
		//信息查看
		function view(Id){
			var layer1=layer.open({
			 	type: 2, 
			 	closeBtn: 1,
			 	title:'<span class="glyphicon glyphicon-import"></span>统计分析',
			 	offset: 'auto',
			 	area: [$(window).width()*0.9+'px', $(window).height()*0.9+'px'],
				content: '/html/PHMTask/taskResult_echart.html?id='+Id, 
				shadeClose: false,
			    maxmin: true,
			    btn: ['<span class="glyphicon glyphicon-remove"></span>取消'],
				yes: function(index, layero){ 
					layer.close(index); 
				}, 
				no: function(index){ 
					layer.close(index);
				}
			  });
			layer.full(layer1);
		}
		 
		
		//新增
		function goTree(){
		 layer.open({
		 	type: 2, 
		 	closeBtn: 1,
		 	title:'<span class="glyphicon glyphicon-import"></span>选择雷达',
		 	offset: 'auto',
		 	area: [$(window).width()*0.9+'px', '580px'],
			content: '/html/radar/radarDeviceInfo_tree.html', 
			shadeClose: false,
		    maxmin: true,
		    btn: ['<span class="glyphicon glyphicon-remove"></span>选择','<span class="glyphicon glyphicon-remove"></span>取消'],
			yes: function(index, layero){  
				var r = $(layero).find("iframe")[0].contentWindow.getRowData();
			 
				if (r == undefined) {
					return;
				}   
				$("#radarId").val(r.data.id);
				changeRadar(r.data.id);
				layer.close(index);
			}, 
			no: function(index){ 
				layer.close(index);
			}
		  }); 
		} 
		function changeRadar(obj) {
			 $("#phmsubsId").html("");
	         $("#phmsubsId").append('<option value="">请选择</option>');
			///alert(obj);
			$.ajax({
				type : "GET",
				url : '/radarSubsystemInfo/getListByRadarId/' +obj,
				dataType : 'json',
				cache : false,
				success : function(data) {
					//  alert(data);
					if (data && data != "") {
							 
							 $("#phmsubsId").html("");
					         $("#phmsubsId").append('<option value="">请选择</option>');
						      $.each(data,function(i,item){  	 
							     $("#phmsubsId").append("<option  value='"+item.id+"'>"+item.subsystemInfo.subsystemName+"</option>");	 
						              　});      
					}
				}
			});
		}
		function init(){ 
		  　 $.ajax({
				type: "GET",
				url: '/taskResult/getMenuFun?menuId='+getParamer("menuId"), 
				dataType:'json',
				cache: false,
				success: function(data){ 
					if(data && data!=""){  
						$.each(data,function(i,item){  	
		                      $("[id^='"+item.btnCode+"']").show();		
						　　});
						 
					     
				    } 
				 }
			   });
		   
		   
		   $.ajax({
				type : "GET",
				url : '/phmtaskInfo/getAll',
				dataType : 'json',
				cache : false,
				success : function(data) {
					//  alert(data);
					if (data && data != "") {
						 	$("#phmfunctionTypeId").html("");
					        $("#phmfunctionTypeId").append('<option value="">请选择</option>');
							   $.each(data.phmfunctionTypeInfos,function(i,item){  	 
							     $("#phmfunctionTypeId").append("<option  value='"+item.id+"'>"+item.phmfunctionTypeName+"</option>");	 
						               　});    
						    
						
					}
				}
			});
		}  
		
		
		function changeSubsystem(obj) {
			 $("#moduleId").html("");
	         $("#moduleId").append('<option value="">请选择</option>');
			$.ajax({
				type : "GET",
				url : '/keyModulesInfo/getListByphmsubsId/' +obj.value,
				dataType : 'json',
				cache : false,
				success : function(data) {
					 /// alert(data);
					if (data && data != "") {
							 $("#moduleId").html("");
					         $("#moduleId").append('<option value="">请选择</option>');
						      $.each(data,function(i,item){  	 
							     $("#moduleId").append("<option  value='"+item.id+"'>"+item.keyModulesName+"</option>");	 
						              　});    					  
					}
				}
			});
		}
		
		
	</script> 
	   <script src="/static/ace/js/bootstrap-datetimepicker.js"></script>
		<script src="/static/ace/js/bootstrap-datetimepicker.zh-CN.js"></script>
		<!-- ace scripts --> 
	<!-- inline scripts related to this page -->
	<!-- 下拉框 -->
	<script src="/static/ace/js/chosen.jquery.js"></script>
	<!-- 日期框 -->
	<script src="/static/ace/js/date-time/bootstrap-datepicker.js"></script>
	<!--提示框-->
	<script type="text/javascript" src="/static/js/jquery.tips.js"></script>
  <script type="text/javascript">
</body>
</html>
